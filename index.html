<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Packing List Generator</title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="js/i18n.js"></script>
    <link href="./output.css" rel="stylesheet">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .checkbox-container:hover .checkmark {
            border-color: #dc2626;
        }

        .checkbox-container input:checked~.checkmark {
            background-color: #dc2626;
            border-color: #dc2626;
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        .checkbox-container input:checked~.checkmark:after {
            display: block;
        }

        .checkbox-container .checkmark:after {
            left: 7px;
            top: 3px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        @media (max-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: repeat(1, 1fr);
            }

            .trip-details {
                order: 2;
            }

            .packing-list {
                order: 1;
                margin-bottom: 1.5rem;
            }
        }

        .category-header {
            background-color: #fee2e2;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .custom-item-form {
            background-color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen" data-lang="en">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="text-center mb-10 relative">
            <div class="absolute top-0 right-0">
                <button id="languageToggle" class="text-sm text-gray-600 hover:text-red-600 transition-colors">
                    <span class="en">üá©üá™ DE</span>
                    <span class="de hidden">üá¨üáß EN</span>
                </button>
            </div>
            <h1 class="text-4xl font-bold bg-gradient-to-r from-red-600 to-red-800 bg-clip-text text-transparent mb-2">
                üß≥ <span class="i18n" data-key="title">Smart Packing List</span></h1>
            <p class="text-gray-600 i18n" data-key="subtitle">‚ú® Generate your perfect packing list based on your trip details ‚ú®</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Trip Details Form -->
            <div class="bg-white p-6 rounded-xl shadow-md lg:col-span-1">
                <h2 class="text-xl font-semibold text-red-700 mb-4 border-b-2 border-red-100 pb-2 i18n" data-key="tripDetails">‚úàÔ∏è Trip Details</h2>

                <div class="space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 i18n" id="nightsLabel" data-key="nights">Number of
                            Nights</label>
                        <input type="number" id="nights" min="1" value="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 i18n" id="weatherLabel" data-key="weather">Weather</label>
                        <select id="weather" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="warm">‚òÄÔ∏è <span class="i18n" data-key="weatherWarm">Warm</span></option>
                            <option value="medium" selected>üå§Ô∏è <span class="i18n" data-key="weatherMedium">Medium</span></option>
                            <option value="cold">‚ùÑÔ∏è <span class="i18n" data-key="weatherCold">Cold</span></option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 i18n" id="accommodationLabel" data-key="accommodation">Accommodation Type</label>
                        <select id="accommodation" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="hotel"><span class="i18n" data-key="accommodationHotel">Hotel</span></option>
                            <option value="hostel"><span class="i18n" data-key="accommodationHostel">Hostel</span></option>
                            <option value="mountain_cabin"><span class="i18n" data-key="accommodationMountainCabin">Mountain Cabin</span></option>
                            <option value="holiday_home"><span class="i18n" data-key="accommodationHolidayHome">Holiday Home</span></option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="beach" class="rounded text-red-600 focus:ring-red-500">
                                <span class="text-sm text-gray-700 i18n" data-key="beach">Beach</span>
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="sauna" class="rounded text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700 i18n" data-key="sauna">Sauna</span>
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="hiking"
                                    class="rounded text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700 i18n" data-key="hiking">Hiking</span>
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="climbing"
                                    class="rounded text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700 i18n" data-key="climbing">Climbing</span>
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="abroad"
                                    class="rounded text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700 i18n" data-key="abroad">Abroad</span>
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="flight"
                                    class="rounded text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700 i18n" data-key="flight">Flight</span>
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="fotos" class="rounded text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700 i18n" data-key="photos">Photos</span>
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="washing_machine"
                                    class="rounded text-indigo-600 focus:ring-indigo-500">
                                <span class="text-sm text-gray-700 i18n" data-key="washingMachine">Washing Machine Available</span>
                            </label>
                        </div>
                    </div>

                    <button id="generateBtn"
                        class="w-full bg-gradient-to-r from-red-600 to-red-800 text-white py-3 px-4 rounded-lg hover:from-red-700 hover:to-red-900 transition duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 shadow-md">
                        ‚ú® Generate Packing List ‚ú®
                    </button>
                </div>
            </div>

            <!-- Packing List -->
            <div class="bg-white p-6 rounded-xl shadow-md lg:col-span-2 packing-list">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-red-700 border-b-2 border-red-100 pb-2 i18n" data-key="yourPackingList">üìã Your Packing List</h2>
                    <div class="text-sm text-gray-500">
                        <span id="packedCount">0</span> <span id="packedStatusText" class="i18n" data-key="of">of</span> <span
                            id="totalCount">0</span> <span id="packedText" class="i18n" data-key="packed">packed</span>
                    </div>
                </div>

                <div id="packingList" class="space-y-3">
                    <div class="text-center py-10 text-gray-400">
                        <i class="fas fa-suitcase text-4xl mb-2 text-indigo-300"></i>
                        <p class="text-indigo-400 i18n" data-key="enterDetails">Enter your trip details and generate your packing list ‚ú®</p>
                    </div>
                </div>

                <div id="progressBar" class="mt-6 hidden">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="progressFill" class="bg-red-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let currentItems = [];
            const generateBtn = document.getElementById('generateBtn');
            const packingList = document.getElementById('packingList');
            const packedCount = document.getElementById('packedCount');
            const totalCount = document.getElementById('totalCount');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');

            // Load saved state if it exists
            function loadSavedState() {
                try {
                    const savedState = localStorage.getItem('packingListState');
                    if (!savedState) return;

                    const state = JSON.parse(savedState);

                    // Restore form inputs
                    if (state.formData) {
                        if (state.formData.nights) document.getElementById('nights').value = state.formData.nights;
                        if (state.formData.weather) document.getElementById('weather').value = state.formData.weather;
                        if (state.formData.accommodation) document.getElementById('accommodation').value = state.formData.accommodation;

                        const checkboxes = ['beach', 'sauna', 'hiking', 'climbing', 'abroad', 'flight', 'fotos', 'washing_machine'];
                        checkboxes.forEach(id => {
                            if (state.formData[id] !== undefined) {
                                document.getElementById(id).checked = state.formData[id];
                            }
                        });
                    }

                    // Always regenerate the packing list from form data to ensure consistency
                    if (state.formData) {
                        // Generate the packing list
                        generatePackingList();

                        // Then restore the checked state after a small delay to ensure DOM is ready
                        if (state.checkedItems) {
                            setTimeout(() => {
                                const checkboxes = document.querySelectorAll('.checkbox-container input[type="checkbox"]');
                                if (checkboxes.length > 0) {
                                    state.checkedItems.forEach((isChecked, index) => {
                                        if (checkboxes[index]) {
                                            checkboxes[index].checked = isChecked;
                                            // Trigger change event to update UI
                                            const event = new Event('change');
                                            checkboxes[index].dispatchEvent(event);
                                        }
                                    });
                                    // Update the progress after all checkboxes are set
                                    updatePackedCount();
                                }
                            }, 100);
                        }
                    }
                } catch (e) {
                    console.error('Error loading saved state:', e);
                    localStorage.removeItem('packingListState');
                }
            }

            // Save current state to localStorage
            function saveState() {
                try {
                    const state = {
                        formData: {
                            nights: document.getElementById('nights').value,
                            weather: document.getElementById('weather').value,
                            accommodation: document.getElementById('accommodation').value,
                            beach: document.getElementById('beach').checked,
                            sauna: document.getElementById('sauna').checked,
                            hiking: document.getElementById('hiking').checked,
                            climbing: document.getElementById('climbing').checked,
                            abroad: document.getElementById('abroad').checked,
                            flight: document.getElementById('flight').checked,
                            fotos: document.getElementById('fotos').checked,
                            washing_machine: document.getElementById('washing_machine').checked
                        },
                        items: currentItems,
                        checkedItems: Array.from(document.querySelectorAll('.checkbox-container input[type="checkbox"]')).map(cb => cb.checked)
                    };
                    localStorage.setItem('packingListState', JSON.stringify(state));
                } catch (e) {
                    console.error('Error saving state:', e);
                }
            }

            // Add event listeners to form inputs to save state on change
            const formInputs = [
                'nights', 'weather', 'accommodation', 'beach', 'sauna',
                'hiking', 'climbing', 'abroad', 'flight', 'fotos', 'washing_machine'
            ];

            formInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', saveState);
                }
            });

            // Load saved state when page loads
            loadSavedState();

            generateBtn.addEventListener('click', function() {
                generatePackingList();
                saveState(); // Save state after generating new list
            });
            function generatePackingList() {
                console.log('Generate button clicked'); // Debug log
                // Get form values
                const nights = parseInt(document.getElementById('nights').value) || 3;
                const weather = document.getElementById('weather').value;
                const beach = document.getElementById('beach').checked;
                const sauna = document.getElementById('sauna').checked;
                const hiking = document.getElementById('hiking').checked;
                const climbing = document.getElementById('climbing').checked;
                const abroad = document.getElementById('abroad').checked;
                const flight = document.getElementById('flight').checked;
                const fotos = document.getElementById('fotos').checked;
                const accommodation = document.getElementById('accommodation').value;
                const washing_machine = document.getElementById('washing_machine').checked;

                // Generate packing list based on parameters
                let items = [];

                // Helper function to add item with duplicate check and translation
                function addItem(itemKey, quantity, category) {
                    // Get current language
                    const lang = document.documentElement.lang || 'en';

                    // Get translated item name
                    let translatedName = translations[lang]?.[itemKey] || itemKey;

                    // Handle pluralization for quantities > 1
                    if (quantity > 1) {
                        // Check if there's a plural form available
                        const pluralKey = itemKey.endsWith('y') ?
                            itemKey.slice(0, -1) + 'ies' :
                            itemKey + 's';

                        if (translations[lang]?.[pluralKey]) {
                            translatedName = translations[lang][pluralKey];
                        } else if (translations[lang]?.[itemKey + 's']) {
                            translatedName = translations[lang][itemKey + 's'];
                        }
                    }

                    // Check if item already exists (case-insensitive)
                    const existingItem = items.find(item =>
                        item.name.toLowerCase() === translatedName.toLowerCase()
                    );

                    if (!existingItem) {
                        items.push({
                            name: translatedName,
                            originalKey: itemKey,
                            quantity,
                            category
                        });
                    }
                }

                // Clothing basics - adjust quantities based on washing machine availability
                if (washing_machine) {
                    const shirtsQty = Math.min(7, Math.ceil(nights));
                    const underpantsQty = Math.min(7, Math.ceil(nights));
                    const socksQty = Math.min(7, Math.ceil(nights));
                    addItem('shirt', shirtsQty, 'clothing');
                    addItem('detergent', 1, 'clothing');
                    addItem('underpant', underpantsQty, 'clothing');
                    addItem('sockPair', socksQty, 'clothing');
                } else {
                    addItem('shirt', nights, 'clothing');
                    addItem('underpant', nights, 'clothing');
                    addItem('sockPair', nights, 'clothing');
                }

                if (weather === 'warm') {
                    addItem('sunscreen', 1, 'personal');
                    addItem('sunglasses', 1, 'personal');
                    if (washing_machine) {
                        const vestsQty = Math.min(2, Math.ceil(nights / 10));
                        const shortsQty = Math.min(2, Math.ceil(nights / 5));
                        addItem('vest', vestsQty, 'clothing');
                        addItem('pairOfShorts', shortsQty, 'clothing');
                    } else {
                        const vestsQty = Math.ceil(nights / 10);
                        const shortsQty = Math.ceil(nights / 5);
                        addItem('vest', vestsQty, 'clothing');
                        addItem('pairOfShorts', shortsQty, 'clothing');
                    }
                } else if (weather === 'medium') {
                    addItem('jacket', 1, 'clothing');
                    if (washing_machine) {
                        const vestsQty = Math.min(2, Math.ceil(nights / 5));
                        const shortsQty = Math.min(2, Math.ceil(nights / 5));
                        const pantsQty = Math.min(2, Math.ceil(nights / 5));
                        addItem('vest', vestsQty, 'clothing');
                        addItem('pairOfShorts', shortsQty, 'clothing');
                        addItem('pairOfPants', pantsQty, 'clothing');
                    } else {
                        const qty = Math.ceil(nights / 5);
                        addItem('vest', qty, 'clothing');
                        addItem('pairOfShorts', qty, 'clothing');
                        addItem('pairOfPants', qty, 'clothing');
                    }
                } else if (weather === 'cold') {
                    addItem('jacket', 1, 'clothing');
                    addItem('pairOfGloves', 1, 'clothing');
                    addItem('hat', 1, 'clothing');
                    if (washing_machine) {
                        const vestsQty = Math.min(2, Math.ceil(nights / 5));
                        const pantsQty = Math.min(2, Math.ceil(nights / 5));
                        addItem('vest', vestsQty, 'clothing');
                        addItem('pairOfPants', pantsQty, 'clothing');
                    } else {
                        const qty = Math.ceil(nights / 5);
                        addItem('vest', qty, 'clothing');
                        addItem('pairOfPants', qty, 'clothing');
                    }
                }

                if (nights > 5) {
                    addItem('additionalShoes', 1, 'clothing')
                }

                // Beach items
                if (beach) {
                    addItem('swimsuit', 1, 'beach');
                    addItem('flipFlops', 1, 'beach');
                    addItem('beachTowel', 1, 'beach');
                    addItem('sunHat', 1, 'beach');
                }

                // Sauna items
                if (sauna) {
                    addItem('swimsuit', 1, 'beach');
                    addItem('saunaTowel', 1, 'sauna');
                    addItem('bathrobe', 1, 'sauna');
                    addItem('slippers', 1, 'sauna');
                    addItem('saunaHat', 1, 'sauna');
                }

                // Hiking items
                if (hiking) {
                    addItem('hikingBoots', 1, 'hiking');
                    addItem('hikingPants', 1, 'hiking');
                    addItem('hikingSocks', 2, 'hiking');
                    addItem('hikingStick', 2, 'hiking');
                    addItem('backpack', 1, 'hiking');
                    addItem('waterBag', 1, 'hiking');
                    addItem('hat', 1, 'clothing');
                    addItem('headlamp', 1, 'clothing');
                    if (weather === 'medium') {
                        addItem('sunscreen', 1, 'personal');
                        addItem('sunglasses', 1, 'personal');
                    }
                }

                // Climbing items
                if (climbing) {
                    addItem('climbingShoes', 1, 'climbing');
                    addItem('viaFerrata', 1, 'climbing');
                    addItem('carabiner', 1, 'climbing');
                    addItem('climbingHarness', 1, 'climbing');
                    addItem('helmet', 1, 'climbing');
                }

                // Electronics
                addItem('phone', 1, 'electronics');
                addItem('phoneCharger', 1, 'electronics');
                addItem('notebook', 1, 'electronics');
                addItem('notebookCharger', 1, 'electronics');
                addItem('headphones', 1, 'electronics');
                addItem('powerBank', 1, 'electronics');
                addItem('steamDeck', 1, 'electronics');
                addItem('usbAdapter', 1, 'electronics');
                addItem('hdmiCable', 1, 'electronics');

                if (fotos) {
                    addItem('camera', 1, 'electronics');
                    addItem('cameraCharger', 1, 'electronics');
                }

                // Travel essentials
                if (abroad) {
                    addItem('passport', 1, 'travel');
                    addItem('travelAdapter', 1, 'travel');
                }

                if (flight) {
                    addItem('neckPillow', 1, 'travel');
                    addItem('earplugs', 1, 'accommodation');
                }

                // Accommodation items
                const accommodationType = document.getElementById('accommodation').value;

                if (accommodationType === 'hostel') {
                    addItem('padlock', 1, 'accommodation');
                    addItem('earplugs', 1, 'accommodation');
                    addItem('slippers', 1, 'personal');
                    addItem('towels', 1, 'accommodation');
                } else if (accommodationType === 'mountain_cabin') {
                    addItem('sleepingBag', 1, 'accommodation');
                    addItem('towel', 1, 'accommodation');
                } else if (accommodationType === 'holiday_home') {
                    addItem('aeropress', 1, 'accommodation');
                    addItem('knife', 1, 'accommodation');
                    addItem('spicery', 1, 'accommodation');
                }

                // Personal care
                addItem('toothbrush', 1, 'personal');
                addItem('toothpaste', 1, 'personal');
                addItem('showerGel', 1, 'personal');
                addItem('deodorant', 1, 'personal');
                addItem('combBrush', 1, 'personal');
                addItem('nightGuard', 1, 'personal');
                if (nights > 3) {
                    addItem('shaver', 1, 'personal');
                }
                if (nights > 7) {
                    addItem('nailClipper', 1, 'personal');
                }

                // Miscellaneous
                addItem('cash', 1, 'misc');
                addItem('waterBottle', 1, 'misc');
                addItem('driversLicense', 1, 'misc');
                addItem('painkillers', 1, 'misc');
                addItem('bandAid', 1, 'misc');
                addItem('disinfectant', 1, 'misc');
                addItem('chewingGum', 1, 'misc');
                addItem('books', 1, 'misc');
                addItem('washingBag', 1, 'clothing');
                addItem('condoms', 1, 'misc');

                console.log('Generated items:', items); // Debug log
                // Display the packing list
                displayPackingList(items);
            }

            function displayPackingList(items) {
                // Clear the current packing list
                packingList.innerHTML = '';

                // Get current language
                const lang = document.documentElement.lang || 'en';
                const translations = document.documentElement.getAttribute('data-translations') ?
                                  JSON.parse(document.documentElement.getAttribute('data-translations')) :
                                  { en: {}, de: {} };

                // Map of category keys to translation keys
                const categoryTranslations = {
                    'clothing': 'categoryClothing',
                    'personal': 'categoryPersonal',
                    'beach': 'categoryBeach',
                    'sauna': 'categorySauna',
                    'hiking': 'categoryHiking',
                    'climbing': 'categoryClimbing',
                    'electronics': 'categoryElectronics',
                    'travel': 'categoryTravel',
                    'accommodation': 'categoryAccommodation',
                    'misc': 'categoryMisc'
                };

                // Group items by category
                const categories = {};
                items.forEach(item => {
                    if (!categories[item.category]) {
                        categories[item.category] = [];
                    }
                    categories[item.category].push(item);
                });

                // Create a section for each category
                Object.entries(categories).forEach(([category, categoryItems]) => {
                    const categorySection = document.createElement('div');
                    categorySection.className = 'mb-6';

                    const categoryTitle = document.createElement('h3');
                    categoryTitle.className = 'text-lg font-semibold text-gray-800 mb-3 border-b pb-1';

                    // Use translated category name
                    const translationKey = categoryTranslations[category] || category;
                    const translatedCategory = translations[lang]?.[translationKey] ||
                                            (category.charAt(0).toUpperCase() + category.slice(1));

                    categoryTitle.textContent = translatedCategory;
                    categorySection.appendChild(categoryTitle);

                    // Create progress bar container
                    const progressContainer = document.createElement('div');
                    progressContainer.className = 'mb-4';

                    // Create progress text (counter)
                    const progressText = document.createElement('div');
                    progressText.className = 'flex justify-between items-center mb-1';

                    const progressCount = document.createElement('span');
                    progressCount.className = 'text-xs text-gray-500';
                    progressCount.textContent = '0/0';

                    progressText.appendChild(progressCount);

                    // Create progress bar
                    const progressBar = document.createElement('div');
                    progressBar.className = 'w-full bg-gray-200 rounded-full h-1.5';
                    progressBar.innerHTML = `
                        <div class="bg-indigo-600 h-1.5 rounded-full category-progress" style="width: 0%" data-category="${category}"></div>
                    `;

                    // Append elements to container
                    progressContainer.appendChild(progressText);
                    progressContainer.appendChild(progressBar);

                    // Add to category section
                    categorySection.appendChild(progressContainer);

                    const itemsList = document.createElement('div');
                    itemsList.className = 'space-y-2';

                    categoryItems.forEach(item => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                        itemDiv.dataset.category = category;

                        const label = document.createElement('label');
                        label.className = 'checkbox-container flex items-center space-x-3 cursor-pointer';

                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.className = 'opacity-0 absolute';
                        checkbox.addEventListener('change', updatePackedCount);

                        const checkmark = document.createElement('span');
                        checkmark.className = 'checkmark w-5 h-5 border border-gray-300 rounded-md bg-white flex-shrink-0';

                        const itemText = document.createElement('span');
                        itemText.className = 'text-gray-700';
                        itemText.textContent = `${item.name}${item.quantity > 1 ? ` (${item.quantity})` : ''}`;

                        label.appendChild(checkbox);
                        label.appendChild(checkmark);
                        label.appendChild(itemText);

                        itemDiv.appendChild(label);
                        itemsList.appendChild(itemDiv);
                    });

                    categorySection.appendChild(itemsList);
                    packingList.appendChild(categorySection);
                });

                // Update the packed count after rendering
                updatePackedCount();
            }

            function updatePackedCount() {
                const checkboxes = document.querySelectorAll('.checkbox-container input[type="checkbox"]');
                const checkedCount = Array.from(checkboxes).filter(checkbox => checkbox.checked).length;
                const total = checkboxes.length;

                packedCount.textContent = checkedCount;
                totalCount.textContent = total;

                // Update progress bar
                const progress = total > 0 ? Math.round((checkedCount / total) * 100) : 0;
                progressFill.style.width = `${progress}%`;

                // Update category progress
                const categoryItems = {};
                document.querySelectorAll('.checkbox-container input[type="checkbox"]').forEach((checkbox) => {
                    const category = checkbox.closest('[data-category]')?.dataset.category || 'uncategorized';
                    if (!categoryItems[category]) {
                        categoryItems[category] = { total: 0, checked: 0 };
                    }
                    categoryItems[category].total++;
                    if (checkbox.checked) {
                        categoryItems[category].checked++;
                    }
                });

                // Update each category's progress
                Object.entries(categoryItems).forEach(([category, { total, checked }]) => {
                    const progress = Math.round((checked / total) * 100);
                    const progressElement = document.querySelector(`.category-progress[data-category="${category}"]`);

                    if (progressElement) {
                        progressElement.style.width = `${progress}%`;

                        // Update category count
                        const progressContainer = progressElement.closest('.mb-4');
                        if (progressContainer) {
                            const countElement = progressContainer.querySelector('.text-xs');
                            if (countElement) {
                                countElement.textContent = `${checked}/${total}`;
                            }
                        }

                        // Update progress bar color based on completion
                        if (progress === 100) {
                            progressElement.classList.remove('bg-indigo-600');
                            progressElement.classList.add('bg-green-500');
                        } else {
                            progressElement.classList.remove('bg-green-500');
                            progressElement.classList.add('bg-indigo-600');
                        }
                    }
                });

                // Save the updated state
                saveState();
            }
        });
    </script>
</body>

</html>
